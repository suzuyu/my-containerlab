hostname lfsw0101

feature nxapi
cfs ipv4 distribute
nv overlay evpn
feature ospf
feature bgp
feature interface-vlan
feature vn-segment-vlan-based
feature lacp
feature vpc
feature lldp
feature bfd
clock timezone JST 9 0
feature nv overlay

no password strength-check
username admin password 5 $5$PJAMHI$W4Ih7NfB87rKZatB0F3LTQtWPHkZK4uhH6Byb767Oj5  role network-admin
username cisco password 5 $5$FCPIIG$RRagIkHJeow6kxDTamd2Xsp4TUkeGCRQeVdz0pHwlD0  role network-admin
username cisco passphrase  lifetime 99999 warntime 14 gracetime 3
ssh key rsa 2048 
no ip domain-lookup
copp profile strict
bfd interval 300 min_rx 300 multiplier 3
bfd startup-timer 0
snmp-server user admin network-admin auth md5 3328CD1117679702547B2F13039654E3AC6A priv aes-128 0153CA151511AC3C1C4A5A330C9253ACA93D localizedV2key
snmp-server user cisco network-admin auth md5 056E98403323A677350C5F675BC31EC5F735 priv aes-128 33199E4E4743BF3E6A11426643C317B4A667 localizedV2key
rmon event 1 log trap public description FATAL(1) owner PMON@FATAL
rmon event 2 log trap public description CRITICAL(2) owner PMON@CRITICAL
rmon event 3 log trap public description ERROR(3) owner PMON@ERROR
rmon event 4 log trap public description WARNING(4) owner PMON@WARNING
rmon event 5 log trap public description INFORMATION(5) owner PMON@INFO

fabric forwarding anycast-gateway-mac 2020.0000.00aa
vlan 1,100,200,2001,3000-3002
vlan 100
  name tenant1-vpc1-server-seg1
  vn-segment 10100
vlan 200
  name tenant2-vpc1-server-seg1
  vn-segment 20200
vlan 2001
  name controller-vpc1-seg1
  vn-segment 100
vlan 3000
  name controller-vpc1-l3vni
  vn-segment 9001
vlan 3001
  name tenant1-vpc1-l3vni
  vn-segment 19001
vlan 3002
  name tenant2-vpc1-l3vni
  vn-segment 29001

no cdp enable
no spanning-tree vlan 10-3900
ip prefix-list all-v4 seq 10 permit 0.0.0.0/0 ge 1 le 32 
ip prefix-list filter-controller-vpc1-from-user-tenant-v4 seq 10 permit 172.16.0.0/16 ge 17 le 24 
ip prefix-list filter-controller-vpc1-from-user-tenant-v4 seq 20 permit 172.17.0.0/16 ge 17 le 24 
ip prefix-list filter-controller-vpc1-to-user-tenant-v4 seq 10 permit 100.64.0.0/16 ge 17 le 24 
ipv6 prefix-list all-v6 seq 10 permit 0::/0 ge 1 le 128 
ipv6 prefix-list filter-controller-vpc1-from-user-tenant-v6 seq 10 permit fd21::/48 ge 49 le 64 
ipv6 prefix-list filter-controller-vpc1-from-user-tenant-v6 seq 20 permit fd22::/48 ge 49 le 64 
ipv6 prefix-list filter-controller-vpc1-to-user-tenant-v6 seq 10 permit fd12::/60 ge 61 le 64 
route-map export-controller-vpc1-v4 permit 10
  match ip address prefix-list filter-controller-vpc1-to-user-tenant-v4 
route-map export-controller-vpc1-v6 permit 10
  match ipv6 address prefix-list filter-controller-vpc1-to-user-tenant-v6 
route-map import-controller-vpc1-v4 permit 10
  match ip address prefix-list filter-controller-vpc1-from-user-tenant-v4 
route-map import-controller-vpc1-v6 permit 10
  match ipv6 address prefix-list filter-controller-vpc1-from-user-tenant-v6 
route-map permit-all-v4 permit 100
  match ip address prefix-list all-v4 
route-map permit-all-v6 permit 100
  match ipv6 address prefix-list all-v6 
vrf context controller-vpc1
  vni 9001
  rd auto
  address-family ipv4 unicast
    route-target both auto
    route-target both auto evpn
  address-family ipv6 unicast
    route-target both auto
    route-target both auto evpn
vrf context management
!  ip name-server 192.168.129.254
!  ip route 0.0.0.0/0 192.168.129.254
vrf context tenant1-vpc1
  vni 19001
  rd auto
  address-family ipv4 unicast
    route-target both auto
    route-target both auto evpn
  address-family ipv6 unicast
    route-target both auto
    route-target both auto evpn
vrf context tenant2-vpc1
  vni 29001
  rd auto
  address-family ipv4 unicast
    route-target both auto
    route-target both auto evpn
  address-family ipv6 unicast
    route-target both auto
    route-target both auto evpn
vpc domain 1
  role priority 100
  peer-keepalive destination 10.0.0.2 source 10.0.0.1 vrf default
  virtual peer-link destination 10.0.0.2 source 10.0.0.1 dscp 56
  delay restore 150
  peer-gateway
  auto-recovery
  ipv6 nd synchronize
  ip arp synchronize

nxapi use-vrf management


interface Vlan1
  no ip redirects
  no ipv6 redirects

interface Vlan100
  description tenant1-vpc1-server-seg1
  no shutdown
  mtu 9216
  vrf member tenant1-vpc1
  no ip redirects
  ip address 172.16.0.254/24
  ipv6 address fd21:0:0:1::1/64
  ipv6 nd suppress-ra
  no ipv6 redirects
  fabric forwarding mode anycast-gateway

interface Vlan200
  description tenant2-vpc1-server-seg1
  no shutdown
  vrf member tenant2-vpc1
  no ip redirects
  ip address 172.17.0.254/24
  ipv6 address fd22:0:0:1::1/64
  ipv6 nd suppress-ra
  no ipv6 redirects
  fabric forwarding mode anycast-gateway

interface Vlan2001
  description controller-vpc1-seg1
  no shutdown
  vrf member controller-vpc1
  no ip redirects
  ip address 100.64.0.254/24
  ipv6 address fd12:0:0:1::1/64
  ipv6 nd suppress-ra
  no ipv6 redirects
  fabric forwarding mode anycast-gateway

interface Vlan3000
  description controller-vpc1
  no shutdown
  vrf member controller-vpc1
  no ip redirects
  ip forward
  ipv6 address use-link-local-only
  no ipv6 redirects

interface Vlan3001
  description tenant1-vpc1
  no shutdown
  vrf member tenant1-vpc1
  no ip redirects
  ip forward
  ipv6 address use-link-local-only
  no ipv6 redirects

interface Vlan3002
  description tenant2-vpc1
  no shutdown
  vrf member tenant2-vpc1
  no ip redirects
  ip forward
  ipv6 address use-link-local-only
  no ipv6 redirects

interface port-channel1
  description virtual-vpc-peer-link
  switchport mode trunk
  spanning-tree port type network
  storm-control broadcast level 40.00
  storm-control multicast level 40.00
  storm-control unicast level 40.00
  storm-control action shutdown
  vpc peer-link

interface port-channel11
  description tenant1-server01 bond0
  switchport mode trunk
  storm-control broadcast level 40.00
  storm-control multicast level 40.00
  storm-control unicast level 40.00
  storm-control action shutdown
  vpc 11

interface port-channel12
  description tenant2-server01 bond0
  switchport mode trunk
  storm-control broadcast level 40.00
  storm-control multicast level 40.00
  storm-control unicast level 40.00
  storm-control action shutdown
  vpc 12

interface port-channel13
  description tenant3-server01 bond0
  switchport mode trunk
  storm-control broadcast level 40.00
  storm-control multicast level 40.00
  storm-control unicast level 40.00
  storm-control action shutdown
  vpc 13

interface nve1
  no shutdown
  host-reachability protocol bgp
  advertise virtual-rmac
  source-interface loopback1
  member vni 100
    ingress-replication protocol bgp
  member vni 9001 associate-vrf
  member vni 10100
    ingress-replication protocol bgp
  member vni 19001 associate-vrf
  member vni 20200
    ingress-replication protocol bgp
  member vni 29001 associate-vrf

interface Ethernet1/1
  description tenant1-server01 ens2
  lacp rate fast
  switchport mode trunk
  storm-control broadcast level 40.00
  storm-control multicast level 40.00
  storm-control unicast level 40.00
  storm-control action shutdown
  channel-group 11 mode active

interface Ethernet1/2
  description tenant2-server01 ens2
  lacp rate fast
  switchport mode trunk
  storm-control broadcast level 40.00
  storm-control multicast level 40.00
  storm-control unicast level 40.00
  storm-control action shutdown
  channel-group 12 mode active

interface Ethernet1/3
  description tenant3-server01 ens2
  lacp rate fast
  switchport mode trunk
  storm-control broadcast level 40.00
  storm-control multicast level 40.00
  storm-control unicast level 40.00
  storm-control action shutdown
  channel-group 13 mode active

interface Ethernet1/4
  shutdown

interface Ethernet1/5
  shutdown

interface Ethernet1/6
  shutdown

interface Ethernet1/7
  description spsw02 eth1/1
  no switchport
  mtu 9216
  port-type fabric
  ip address 10.0.4.0/31
  ip ospf network point-to-point
  ip router ospf UNDERLAY area 0.0.0.0
  ip ospf bfd
  no shutdown

interface Ethernet1/8
  description spsw01 eth1/1
  no switchport
  mtu 9216
  port-type fabric
  ip address 10.0.3.0/31
  ip ospf network point-to-point
  ip router ospf UNDERLAY area 0.0.0.0
  ip ospf bfd
  no shutdown

interface Ethernet1/9

interface Ethernet1/10

interface Ethernet1/11

interface Ethernet1/12

interface Ethernet1/13

interface Ethernet1/14

interface Ethernet1/15

interface Ethernet1/16

interface Ethernet1/17

interface Ethernet1/18

interface Ethernet1/19

interface Ethernet1/20

interface Ethernet1/21

interface Ethernet1/22

interface Ethernet1/23

interface Ethernet1/24

interface Ethernet1/25

interface Ethernet1/26

interface Ethernet1/27

interface Ethernet1/28

interface Ethernet1/29

interface Ethernet1/30

interface Ethernet1/31

interface Ethernet1/32

interface Ethernet1/33

interface Ethernet1/34

interface Ethernet1/35

interface Ethernet1/36

interface Ethernet1/37

interface Ethernet1/38

interface Ethernet1/39

interface Ethernet1/40

interface Ethernet1/41

interface Ethernet1/42

interface Ethernet1/43

interface Ethernet1/44

interface Ethernet1/45

interface Ethernet1/46

interface Ethernet1/47

interface Ethernet1/48

interface Ethernet1/49

interface Ethernet1/50

interface Ethernet1/51

interface Ethernet1/52

interface Ethernet1/53

interface Ethernet1/54

interface Ethernet1/55

interface Ethernet1/56

interface Ethernet1/57

interface Ethernet1/58

interface Ethernet1/59

interface Ethernet1/60

interface Ethernet1/61

interface Ethernet1/62

interface Ethernet1/63

interface Ethernet1/64

!interface mgmt0
!  vrf member management
!  ip address 192.168.129.81/24

interface loopback0
  description RouterID Loopback
  ip address 10.0.0.1/32
  ip router ospf UNDERLAY area 0.0.0.0

interface loopback1
  description VTEP Loopback
  ip address 10.0.1.1/32
  ip address 10.0.2.1/32 secondary
  ip router ospf UNDERLAY area 0.0.0.0
icam monitor scale

line console
  exec-timeout 0
line vty
  exec-timeout 0
router ospf UNDERLAY
  bfd
  router-id 10.0.0.1
  max-metric router-lsa on-startup
  log-adjacency-changes
router bgp 65001
  router-id 10.0.0.1
  log-neighbor-changes
  address-family l2vpn evpn
    advertise-pip
  neighbor 10.0.0.253
    remote-as internal
    update-source loopback0
    address-family l2vpn evpn
      send-community
      send-community extended
  neighbor 10.0.0.254
    remote-as internal
    update-source loopback0
    address-family l2vpn evpn
      send-community
      send-community extended
  vrf controller-vpc1
    address-family ipv4 unicast
      redistribute direct route-map permit-all-v4
    address-family ipv6 unicast
      redistribute direct route-map permit-all-v6
  vrf tenant1-vpc1
    address-family ipv4 unicast
      redistribute direct route-map permit-all-v4
    address-family ipv6 unicast
      redistribute direct route-map permit-all-v6
  vrf tenant2-vpc1
    address-family ipv4 unicast
      redistribute direct route-map permit-all-v4
    address-family ipv6 unicast
      redistribute direct route-map permit-all-v6
evpn
  vni 100 l2
    rd auto
    route-target import auto
    route-target export auto
  vni 10100 l2
    rd auto
    route-target import auto
    route-target export auto
  vni 20200 l2
    rd auto
    route-target import auto
    route-target export auto

no logging console